# Nanogridata Gateway Deployment
# Minimal footprint, zero extra load on existing services

version: '3.8'

services:
  # Existing ALBA service (unchanged)
  alba:
    image: clisonix/alba:latest
    ports:
      - "5555:5555"
    environment:
      - LOG_LEVEL=info
    networks:
      - clisonix

  # NEW: Nanogridata Gateway Service
  nanogridata-gateway:
    build:
      context: .
      dockerfile: Dockerfile.nanogridata
    ports:
      - "5678:5678"  # TCP listener for embedded devices
      - "5679:5679"  # Metrics/monitoring endpoint
    environment:
      - LOG_LEVEL=info
      - NANOGRIDATA_ESP32_SECRET=${NANOGRIDATA_ESP32_SECRET}
      - NANOGRIDATA_STM32_SECRET=${NANOGRIDATA_STM32_SECRET}
      - ALBA_ENDPOINT=http://alba:5555
      - CYCLE_ENDPOINT=http://cycle:5556
    depends_on:
      - alba
    networks:
      - clisonix
    restart: unless-stopped

  # Existing services unchanged...
  cycle:
    image: clisonix/cycle:latest
    ports:
      - "5556:5556"
    environment:
      - LOG_LEVEL=info
    networks:
      - clisonix

networks:
  clisonix:
    driver: bridge
