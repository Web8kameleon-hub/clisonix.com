services:
  # ==========================
  # DATABASES
  # ==========================
  postgres:
    image: postgres:16-alpine
    container_name: clisonix-postgres
    environment:
      POSTGRES_USER: clisonix
      POSTGRES_PASSWORD: clisonix
      POSTGRES_DB: clisonixdb
    ports:
      - "5432:5432"
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U clisonix"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    container_name: clisonix-redis
    ports:
      - "6379:6379"
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  # ==========================
  # NEO4J (Graph Database)
  # ==========================
  neo4j:
    image: neo4j:5-community
    container_name: clisonix-neo4j
    environment:
      NEO4J_AUTH: neo4j/clisonix123
      NEO4J_PLUGINS: '["apoc"]'
    ports:
      - "7474:7474"
      - "7687:7687"
    volumes:
      - ./data/neo4j:/data
    healthcheck:
      test: ["CMD-SHELL", "wget -q --spider http://localhost:7474 || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
    restart: unless-stopped

  # ==========================
  # MINIO (Object Storage)
  # ==========================
  minio:
    image: minio/minio:latest
    container_name: clisonix-minio
    environment:
      MINIO_ROOT_USER: clisonix
      MINIO_ROOT_PASSWORD: clisonix123
    command: server /data --console-address ":9001"
    ports:
      - "9000:9000"
      - "9001:9001"
    volumes:
      - ./data/minio:/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # ASI TRINITY - ALBA (Analytical Intelligence)
  # ==========================
  alba:
    build:
      context: .
      dockerfile: Dockerfile.alba
    container_name: clisonix-alba
    environment:
      PYTHONUNBUFFERED: "1"
      REDIS_URL: "redis://redis:6379/0"
    ports:
      - "5555:5555"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5555/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # ASI TRINITY - ALBI (Creative Intelligence)
  # ==========================
  albi:
    build:
      context: .
      dockerfile: Dockerfile.albi
    container_name: clisonix-albi
    environment:
      PYTHONUNBUFFERED: "1"
      REDIS_URL: "redis://redis:6379/0"
      PORT: "6680"
    ports:
      - "6680:6680"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:6680/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # ASI TRINITY - JONA (Emotional Intelligence)
  # ==========================
  jona:
    build:
      context: .
      dockerfile: Dockerfile.jona
    container_name: clisonix-jona
    environment:
      PYTHONUNBUFFERED: "1"
      REDIS_URL: "redis://redis:6379/0"
      PORT: "7777"
    ports:
      - "7777:7777"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7777/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # OLLAMA (LLM Backend)
  # ==========================
  ollama:
    image: ollama/ollama:latest
    container_name: clisonix-ollama
    ports:
      - "11434:11434"
    volumes:
      - ollama_data:/root/.ollama
    environment:
      OLLAMA_HOST: "0.0.0.0"
    healthcheck:
      test: ["CMD-SHELL", "ollama list || exit 0"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s
    restart: unless-stopped

  # ==========================
  # OLLAMA MULTI-API (Multi-Model Router)
  # ==========================
  ollama-multi-api:
    build:
      context: .
      dockerfile: Dockerfile.ollama-multi
    container_name: clisonix-ollama-multi-api
    environment:
      PYTHONUNBUFFERED: "1"
      OLLAMA_HOST: "http://clisonix-ollama:11434"
      PORT: "4444"
    ports:
      - "4444:4444"
    depends_on:
      ollama:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4444/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # OCEAN-CORE (Knowledge Engine & Curiosity AI)
  # ==========================
  ocean-core:
    build:
      context: ./ocean-core
      dockerfile: Dockerfile
    container_name: clisonix-ocean-core
    environment:
      PYTHONUNBUFFERED: "1"
      OCEAN_PORT: "8030"
      OLLAMA_HOST: "http://clisonix-ollama:11434"
      MODEL: "llama3.1:8b"
      REDIS_URL: "redis://redis:6379/0"
    ports:
      - "8030:8030"
    depends_on:
      ollama:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8030/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # AVIATION WEATHER API (Microservice)
  # ==========================
  aviation:
    build:
      context: ./services/aviation-weather
      dockerfile: Dockerfile
    container_name: clisonix-aviation
    environment:
      PYTHONUNBUFFERED: "1"
      AVIATION_PORT: "8080"
      AVWX_API_KEY: "${AVWX_API_KEY:-}"
      CHECKWX_API_KEY: "${CHECKWX_API_KEY:-}"
    ports:
      - "8080:8080"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # API BACKEND (JONA - Coordinator)
  # ==========================
  api:
    build:
      context: ./apps/api
      dockerfile: Dockerfile
    container_name: clisonix-api
    environment:
      PYTHONUNBUFFERED: "1"
      API_PORT: "8000"
      DATABASE_URL: "postgresql://clisonix:clisonix@postgres:5432/clisonixdb"
      REDIS_URL: "redis://redis:6379/0"
    ports:
      - "8000:8000"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # FRONTEND
  # ==========================
  web:
    build:
      context: ./apps/web
      dockerfile: Dockerfile
    container_name: clisonix-web
    environment:
      NODE_ENV: "production"
      # Use Docker internal network for server-side API calls
      API_INTERNAL_URL: "http://clisonix-api:8000"
      # Client-side calls go through Nginx proxy
      NEXT_PUBLIC_API_BASE: "/api"
      # Clerk Authentication
      NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY: ${NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY}
      CLERK_SECRET_KEY: ${CLERK_SECRET_KEY}
      NEXT_PUBLIC_CLERK_SIGN_IN_URL: "/sign-in"
      NEXT_PUBLIC_CLERK_SIGN_UP_URL: "/sign-up"
      NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL: "/dashboard"
      NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL: "/dashboard"
      # Stripe Payments
      NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY: ${NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY}
      STRIPE_SECRET_KEY: ${STRIPE_SECRET_KEY}
      STRIPE_WEBHOOK_SECRET: ${STRIPE_WEBHOOK_SECRET}
      # Kitchen API
      KITCHEN_JOBS_DIR: "/app/kitchen-jobs"
      KITCHEN_REPORTS_DIR: "/app/kitchen-reports"
      KITCHEN_RUN_API_KEY: ${KITCHEN_RUN_API_KEY:-clisonix-kitchen-secret}
    ports:
      - "3000:3000"
    volumes:
      # Share kitchen jobs/reports with worker
      - kitchen_jobs:/app/kitchen-jobs
      - kitchen_reports:/app/kitchen-reports
    depends_on:
      api:
        condition: service_healthy
    restart: unless-stopped

  # ==========================
  # VICTORIAMETRICS (Long-term Storage)
  # ==========================
  victoriametrics:
    image: victoriametrics/victoria-metrics:v1.96.0
    container_name: clisonix-victoriametrics
    ports:
      - "8428:8428"
    volumes:
      - ./data/victoriametrics:/victoria-metrics-data
    command:
      - "-storageDataPath=/victoria-metrics-data"
      - "-retentionPeriod=12"
      - "-httpListenAddr=0.0.0.0:8428"
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://127.0.0.1:8428/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # PROMETHEUS (Metrics Collection)
  # ==========================
  prometheus:
    image: prom/prometheus:v2.48.0
    container_name: clisonix-prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./config/prometheus.yml:/etc/prometheus/prometheus.yml:ro
      - ./data/prometheus:/prometheus
    command:
      - "--config.file=/etc/prometheus/prometheus.yml"
      - "--storage.tsdb.path=/prometheus"
      - "--web.enable-lifecycle"
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:9090/-/healthy"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # GRAFANA (Visualization)
  # ==========================
  grafana:
    image: grafana/grafana:10.2.0
    container_name: clisonix-grafana
    environment:
      GF_SECURITY_ADMIN_PASSWORD: clisonix123
      GF_USERS_ALLOW_SIGN_UP: "false"
    ports:
      - "3001:3000"
    volumes:
      - ./data/grafana:/var/lib/grafana
    depends_on:
      - prometheus
      - victoriametrics
    healthcheck:
      test: ["CMD-SHELL", "wget -q --spider http://localhost:3000/api/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # LOKI (Log Aggregation)
  # ==========================
  loki:
    image: grafana/loki:2.9.2
    container_name: clisonix-loki
    ports:
      - "3102:3100"
    volumes:
      - ./data/loki:/loki
    command: -config.file=/etc/loki/local-config.yaml
    healthcheck:
      test: ["CMD-SHELL", "wget -q --spider http://localhost:3100/ready || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # JAEGER (Distributed Tracing)
  # ==========================
  jaeger:
    image: jaegertracing/all-in-one:1.52
    container_name: clisonix-jaeger
    environment:
      COLLECTOR_OTLP_ENABLED: "true"
    ports:
      - "16686:16686"
      - "14268:14268"
      - "4317:4317"
    healthcheck:
      test: ["CMD-SHELL", "wget -q --spider http://localhost:16686/ || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # TEMPO (Trace Backend)
  # ==========================
  tempo:
    image: grafana/tempo:2.3.1
    container_name: clisonix-tempo
    ports:
      - "3200:3200"
      - "9095:9095"
    volumes:
      - ./data/tempo:/tmp/tempo
    command: ["-config.file=/etc/tempo.yaml"]
    healthcheck:
      test: ["CMD-SHELL", "wget -q --spider http://localhost:3200/ready || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # TRAEFIK (API Gateway & Load Balancer)
  # ==========================
  traefik:
    image: traefik:v2.10
    container_name: clisonix-traefik
    command:
      - "--api.insecure=true"
      - "--providers.docker=true"
      - "--entrypoints.web.address=:80"
    ports:
      - "80:80"
      - "8088:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    healthcheck:
      test: ["CMD", "traefik", "healthcheck"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # ASI ENGINE (Artificial Super Intelligence)
  # ==========================
  asi:
    build:
      context: .
      dockerfile: Dockerfile.asi
    container_name: clisonix-asi
    environment:
      PYTHONUNBUFFERED: "1"
      REDIS_URL: "redis://redis:6379/0"
    ports:
      - "9094:9094"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9094/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # MARKETPLACE (API Keys, Billing, SaaS)
  # ==========================
  marketplace:
    build:
      context: .
      dockerfile: Dockerfile.marketplace
    container_name: clisonix-marketplace
    environment:
      PYTHONUNBUFFERED: "1"
      REDIS_URL: "redis://redis:6379/0"
      STRIPE_SECRET_KEY: "${STRIPE_SECRET_KEY}"
      STRIPE_PUBLISHABLE_KEY: "${STRIPE_PUBLISHABLE_KEY}"
      STRIPE_WEBHOOK_SECRET: "${STRIPE_WEBHOOK_SECRET}"
    ports:
      - "8004:8004"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8004/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # CONTENT FACTORY (Blerina + EAP + Publisher)
  # ==========================
  content-factory:
    build:
      context: .
      dockerfile: services/content-factory/Dockerfile
    container_name: clisonix-content-factory
    environment:
      PYTHONUNBUFFERED: "1"
      PORT: "8006"
      OLLAMA_HOST: "http://clisonix-ollama:11434"
      GITHUB_TOKEN: "${GITHUB_TOKEN}"
      BLOG_REPO_URL: "${BLOG_REPO_URL:-https://github.com/LedjanAhmati/clisonix-blog.git}"
    ports:
      - "8006:8006"
    depends_on:
      ollama:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8006/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # CORE ENGINES
  # ==========================

  # ALPHABET LAYERS (Multi-tier AI Processing)
  alphabet-layers:
    build:
      context: .
      dockerfile: Dockerfile.alphabet-layers
    container_name: clisonix-alphabet-layers
    environment:
      PYTHONUNBUFFERED: "1"
      REDIS_URL: "redis://redis:6379/0"
      PORT: "8061"
    ports:
      - "8061:8061"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8061/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # LIAM (Learning Intelligence Adaptive Module)
  liam:
    build:
      context: .
      dockerfile: Dockerfile.liam
    container_name: clisonix-liam
    environment:
      PYTHONUNBUFFERED: "1"
      REDIS_URL: "redis://redis:6379/0"
      PORT: "8062"
    ports:
      - "8062:8062"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8062/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ALDA (Adaptive Learning Data Analyzer)
  alda:
    build:
      context: .
      dockerfile: Dockerfile.alda
    container_name: clisonix-alda
    environment:
      PYTHONUNBUFFERED: "1"
      REDIS_URL: "redis://redis:6379/0"
      PORT: "8063"
    ports:
      - "8063:8063"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8063/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ALBA-IDLE (Background Processing Mode)
  alba-idle:
    build:
      context: .
      dockerfile: Dockerfile.alba-idle
    container_name: clisonix-alba-idle
    environment:
      PYTHONUNBUFFERED: "1"
      REDIS_URL: "redis://redis:6379/0"
      PORT: "8031"
    ports:
      - "8031:8031"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8031/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # BLERINA (Content Generation Engine)
  blerina:
    build:
      context: .
      dockerfile: Dockerfile.blerina
    container_name: clisonix-blerina
    environment:
      PYTHONUNBUFFERED: "1"
      OLLAMA_HOST: "http://clisonix-ollama:11434"
      PORT: "8035"
    ports:
      - "8035:8035"
    depends_on:
      ollama:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8035/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # SAAS-API (Multi-tenant SaaS Platform)
  saas-api:
    build:
      context: .
      dockerfile: Dockerfile.saas-api
    container_name: clisonix-saas-api
    environment:
      PYTHONUNBUFFERED: "1"
      REDIS_URL: "redis://redis:6379/0"
      PORT: "8040"
    ports:
      - "8040:8040"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8040/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # PERSONAS (AI Personality Manager)
  personas:
    build:
      context: .
      dockerfile: Dockerfile.personas
    container_name: clisonix-personas
    environment:
      PYTHONUNBUFFERED: "1"
      REDIS_URL: "redis://redis:6379/0"
      PORT: "9200"
    ports:
      - "9200:9200"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9200/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # MULTI-TENANT (Tenant Isolation Service)
  multi-tenant:
    build:
      context: .
      dockerfile: Dockerfile.multi-tenant
    container_name: clisonix-multi-tenant
    environment:
      PYTHONUNBUFFERED: "1"
      REDIS_URL: "redis://redis:6379/0"
      PORT: "8007"
    ports:
      - "8007:8007"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8007/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # USER MANAGEMENT (Centralized User Registry)
  # ==========================
  user-management:
    build:
      context: ./services/user-management
      dockerfile: Dockerfile
    container_name: clisonix-user-management
    environment:
      PYTHONUNBUFFERED: "1"
      USER_MANAGEMENT_PORT: "8070"
      CLERK_WEBHOOK_SECRET: "${CLERK_WEBHOOK_SECRET}"
      CLERK_SECRET_KEY: "${CLERK_SECRET_KEY}"
    ports:
      - "8070:8070"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8070/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # INTELLIGENCE LAB (KLAJDI + MALI)
  # ==========================
  intelligence-lab:
    build:
      context: ./services/intelligence-lab
      dockerfile: Dockerfile
    container_name: clisonix-intelligence-lab
    environment:
      PYTHONUNBUFFERED: "1"
      INTELLIGENCE_LAB_PORT: "8098"
    ports:
      - "8098:8098"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8098/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # AGIEM (AI General Intelligence Engine Manager)
  # ==========================
  agiem:
    build:
      context: .
      dockerfile: Dockerfile.agiem
    container_name: clisonix-agiem
    environment:
      PYTHONUNBUFFERED: "1"
      REDIS_URL: "redis://redis:6379/0"
      PORT: "9300"
    ports:
      - "9300:9300"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9300/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # DATASOURCES (Regional Data Providers)
  # ==========================
  datasource-europe:
    build:
      context: .
      dockerfile: Dockerfile.datasource
    container_name: clisonix-datasource-europe
    environment:
      PYTHONUNBUFFERED: "1"
      REGION: "europe"
      PORT: "9301"
    ports:
      - "9301:9301"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9301/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  datasource-americas:
    build:
      context: .
      dockerfile: Dockerfile.datasource
    container_name: clisonix-datasource-americas
    environment:
      PYTHONUNBUFFERED: "1"
      REGION: "americas"
      PORT: "9302"
    ports:
      - "9302:9302"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9302/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  datasource-asia:
    build:
      context: .
      dockerfile: Dockerfile.datasource
    container_name: clisonix-datasource-asia
    environment:
      PYTHONUNBUFFERED: "1"
      REGION: "asia"
      PORT: "9303"
    ports:
      - "9303:9303"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9303/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  datasource-india:
    build:
      context: .
      dockerfile: Dockerfile.datasource
    container_name: clisonix-datasource-india
    environment:
      PYTHONUNBUFFERED: "1"
      REGION: "india"
      PORT: "9304"
    ports:
      - "9304:9304"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9304/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  datasource-africa:
    build:
      context: .
      dockerfile: Dockerfile.datasource
    container_name: clisonix-datasource-africa
    environment:
      PYTHONUNBUFFERED: "1"
      REGION: "africa"
      PORT: "9305"
    ports:
      - "9305:9305"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9305/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  datasource-oceania:
    build:
      context: .
      dockerfile: Dockerfile.datasource
    container_name: clisonix-datasource-oceania
    environment:
      PYTHONUNBUFFERED: "1"
      REGION: "oceania"
      PORT: "9306"
    ports:
      - "9306:9306"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9306/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  datasource-central-asia:
    build:
      context: .
      dockerfile: Dockerfile.datasource
    container_name: clisonix-datasource-central-asia
    environment:
      PYTHONUNBUFFERED: "1"
      REGION: "central-asia"
      PORT: "9307"
    ports:
      - "9307:9307"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9307/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  datasource-antarctica:
    build:
      context: .
      dockerfile: Dockerfile.datasource
    container_name: clisonix-datasource-antarctica
    environment:
      PYTHONUNBUFFERED: "1"
      REGION: "antarctica"
      PORT: "9308"
    ports:
      - "9308:9308"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9308/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # COGNITIVE SERVICES
  # ==========================
  agent-telemetry:
    build:
      context: .
      dockerfile: Dockerfile.agent-telemetry
    container_name: clisonix-agent-telemetry
    environment:
      PYTHONUNBUFFERED: "1"
      PORT: "8009"
    ports:
      - "8009:8009"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8009/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  cognitive-engine:
    build:
      context: .
      dockerfile: Dockerfile.cognitive
    container_name: clisonix-cognitive-engine
    environment:
      PYTHONUNBUFFERED: "1"
      PORT: "8010"
    ports:
      - "8010:8010"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8010/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  adaptive-router:
    build:
      context: .
      dockerfile: Dockerfile.adaptive-router
    container_name: clisonix-adaptive-router
    environment:
      PYTHONUNBUFFERED: "1"
      PORT: "8011"
    ports:
      - "8011:8011"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8011/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # EXCEL MICROSERVICE
  # ==========================
  excel:
    build:
      context: ./services/excel
      dockerfile: Dockerfile
    container_name: clisonix-excel
    environment:
      PYTHONUNBUFFERED: "1"
      CORE_API_URL: "http://clisonix-api:8000"
    ports:
      - "8002:8002"
    volumes:
      - ./excel_files:/app/excel_files
      - ./uploads:/app/uploads
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8002/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # REPORTING (Excel, PowerPoint, Dashboard)
  # ==========================
  reporting:
    build:
      context: .
      dockerfile: Dockerfile.reporting
    container_name: clisonix-reporting
    environment:
      PYTHONUNBUFFERED: "1"
    ports:
      - "8001:8001"
    volumes:
      - ./reports:/app/reports
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8001/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # ECONOMY (Billing, Credits, Usage)
  # ==========================
  economy:
    build:
      context: .
      dockerfile: Dockerfile.economy
    container_name: clisonix-economy
    environment:
      PYTHONUNBUFFERED: "1"
      ECONOMY_API_PORT: "9093"
    ports:
      - "9093:9093"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9093/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # BEHAVIORAL SCIENCE (Mood, Habits, Focus Analytics)
  # ==========================
  behavioral:
    build:
      context: .
      dockerfile: Dockerfile.behavioral
    container_name: clisonix-behavioral
    environment:
      PYTHONUNBUFFERED: "1"
    ports:
      - "8003:8003"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8003/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # CYCLE ENGINE (Advanced Cycle Alignments)
  # ==========================
  cycle:
    build:
      context: .
      dockerfile: Dockerfile.cycle
    container_name: clisonix-cycle
    environment:
      PYTHONUNBUFFERED: "1"
      REDIS_URL: "redis://redis:6379/0"
    ports:
      - "8005:8005"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8005/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # NEUROSONIX (Industrial Neuroscience)
  # ==========================
  neurosonix:
    build:
      context: .
      dockerfile: Dockerfile.neurosonix
    container_name: clisonix-neurosonix
    environment:
      PYTHONUNBUFFERED: "1"
      PORT: "8015"
    ports:
      - "8015:8015"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8015/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # ADVANCED ANALYTICS (Data Science)
  # ==========================
  analytics:
    build:
      context: .
      dockerfile: Dockerfile.analytics
    container_name: clisonix-analytics
    environment:
      PYTHONUNBUFFERED: "1"
      DATABASE_URL: "postgresql://clisonix:clisonix@postgres:5432/clisonixdb"
      PORT: "8016"
    ports:
      - "8016:8016"
    depends_on:
      postgres:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8016/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # SAAS ENGINE (SaaS Signal Processing)
  # ==========================
  saas:
    build:
      context: .
      dockerfile: Dockerfile.saas
    container_name: clisonix-saas
    environment:
      PYTHONUNBUFFERED: "1"
      REDIS_URL: "redis://redis:6379/0"
      SAAS_PORT: "8008"
    ports:
      - "8008:8008"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8008/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # HYBRID BIOMETRIC (Biometric Analysis)
  # ==========================
  biometric:
    build:
      context: .
      dockerfile: Dockerfile.biometric
    container_name: clisonix-biometric
    environment:
      PYTHONUNBUFFERED: "1"
      PORT: "8017"
    ports:
      - "8017:8017"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8017/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # USER DATA API (User Management)
  # ==========================
  userdata:
    build:
      context: .
      dockerfile: Dockerfile.userdata
    container_name: clisonix-userdata
    environment:
      PYTHONUNBUFFERED: "1"
      DATABASE_URL: "postgresql://clisonix:clisonix@postgres:5432/clisonixdb"
      REDIS_URL: "redis://redis:6379/0"
      PORT: "8018"
    ports:
      - "8018:8018"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8018/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # CURIOSITY OCEAN API (Knowledge Discovery)
  # ==========================
  curiosity:
    build:
      context: ./services/curiosity_ocean
      dockerfile: Dockerfile
    container_name: clisonix-curiosity
    environment:
      PYTHONUNBUFFERED: "1"
      OCEAN_CORE_URL: "http://clisonix-ocean-core:8030"
      PORT: "8019"
    ports:
      - "8019:8019"
    depends_on:
      - ocean-core
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8019/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # KNOWLEDGE INDEX (Search & Indexing)
  # ==========================
  knowledge:
    build:
      context: ./services/knowledge_index
      dockerfile: Dockerfile
    container_name: clisonix-knowledge
    environment:
      PYTHONUNBUFFERED: "1"
      REDIS_URL: "redis://redis:6379/0"
    ports:
      - "8012:8012"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8012/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # REGIONAL LABS (23 Global Research Centers)
  # ==========================
  lab-elbasan:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-elbasan
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Elbasan"
      PORT: "9101"
    ports:
      - "9101:9101"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9101/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-tirana:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-tirana
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Tirana"
      PORT: "9102"
    ports:
      - "9102:9102"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9102/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-durres:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-durres
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Durres"
      PORT: "9103"
    ports:
      - "9103:9103"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9103/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-vlore:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-vlore
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Vlore"
      PORT: "9104"
    ports:
      - "9104:9104"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9104/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-shkoder:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-shkoder
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Shkoder"
      PORT: "9105"
    ports:
      - "9105:9105"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9105/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-korce:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-korce
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Korce"
      PORT: "9106"
    ports:
      - "9106:9106"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9106/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-saranda:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-saranda
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Saranda"
      PORT: "9107"
    ports:
      - "9107:9107"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9107/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-prishtina:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-prishtina
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Prishtina"
      PORT: "9108"
    ports:
      - "9108:9108"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9108/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-kostur:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-kostur
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Kostur"
      PORT: "9109"
    ports:
      - "9109:9109"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9109/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-athens:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-athens
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Athens"
      PORT: "9110"
    ports:
      - "9110:9110"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9110/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-rome:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-rome
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Rome"
      PORT: "9111"
    ports:
      - "9111:9111"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9111/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-zurich:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-zurich
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Zurich"
      PORT: "9112"
    ports:
      - "9112:9112"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9112/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-beograd:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-beograd
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Beograd"
      PORT: "9113"
    ports:
      - "9113:9113"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9113/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-sofia:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-sofia
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Sofia"
      PORT: "9114"
    ports:
      - "9114:9114"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9114/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-zagreb:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-zagreb
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Zagreb"
      PORT: "9115"
    ports:
      - "9115:9115"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9115/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-ljubljana:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-ljubljana
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Ljubljana"
      PORT: "9116"
    ports:
      - "9116:9116"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9116/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-vienna:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-vienna
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Vienna"
      PORT: "9117"
    ports:
      - "9117:9117"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9117/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-prague:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-prague
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Prague"
      PORT: "9118"
    ports:
      - "9118:9118"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9118/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-budapest:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-budapest
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Budapest"
      PORT: "9119"
    ports:
      - "9119:9119"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9119/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-bucharest:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-bucharest
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Bucharest"
      PORT: "9120"
    ports:
      - "9120:9120"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9120/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-istanbul:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-istanbul
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Istanbul"
      PORT: "9121"
    ports:
      - "9121:9121"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9121/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-cairo:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-cairo
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Cairo"
      PORT: "9122"
    ports:
      - "9122:9122"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9122/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  lab-jerusalem:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-jerusalem
    environment:
      PYTHONUNBUFFERED: "1"
      LAB_NAME: "Jerusalem"
      PORT: "9123"
    ports:
      - "9123:9123"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9123/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================
  # KITCHEN WORKER (Newman Test Runner)
  # ==========================
  kitchen-worker:
    build:
      context: ./services/kitchen-worker
      dockerfile: Dockerfile
    container_name: clisonix-kitchen-worker
    environment:
      NODE_ENV: "production"
      KITCHEN_JOBS_DIR: "/app/kitchen-jobs"
      KITCHEN_REPORTS_DIR: "/app/kitchen-reports"
      COLLECTIONS_DIR: "/app/postman-collections"
      POLL_INTERVAL_MS: "3000"
      MAX_CONCURRENT_JOBS: "2"
      HEALTH_PORT: "3100"
    ports:
      - "3100:3100"
    volumes:
      # Share jobs/reports with web container
      - kitchen_jobs:/app/kitchen-jobs
      - kitchen_reports:/app/kitchen-reports
      # Mount Postman collections from postman-collections folder only
      - ./postman-collections:/app/postman-collections:ro
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:3100/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

volumes:
  ollama_data:
    driver: local
  kitchen_jobs:
    driver: local
  kitchen_reports:
    driver: local

networks:
  default:
    driver: bridge
