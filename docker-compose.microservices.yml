# ═══════════════════════════════════════════════════════════════════════════════════════════════════
# CLISONIX CLOUD - FULL MICROSERVICES ARCHITECTURE
# ═══════════════════════════════════════════════════════════════════════════════════════════════════
# 
# Arkitektura e Plotë e Clisonix Cloud me 50+ Containers:
# 
# ┌────────────────────────────────────────────────────────────────────────────────────────────────┐
# │                                    DATABASES & CACHE                                           │
# │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌────────────────┐                                 │
# │  │ Postgres │  │  Redis   │  │  Neo4j   │  │ VictoriaMetrics│                                 │
# │  │  :5432   │  │  :6379   │  │ :7474    │  │    :8428       │                                 │
# │  └──────────┘  └──────────┘  └──────────┘  └────────────────┘                                 │
# └────────────────────────────────────────────────────────────────────────────────────────────────┘
# 
# ┌────────────────────────────────────────────────────────────────────────────────────────────────┐
# │                              ASI TRINITY (Super Intelligence)                                  │
# │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐                                       │
# │  │  ALBA    │  │  ALBI    │  │  JONA    │  │   ASI    │                                       │
# │  │  :5555   │  │  :6680   │  │  :7777   │  │  :9094   │                                       │
# │  │ Collector│  │ Learner  │  │ Sandbox  │  │ Combined │                                       │
# │  └──────────┘  └──────────┘  └──────────┘  └──────────┘                                       │
# └────────────────────────────────────────────────────────────────────────────────────────────────┘
# 
# ┌────────────────────────────────────────────────────────────────────────────────────────────────┐
# │                           23 LABORATORIES (City-Named)                                         │
# │  Elbasan│Tirana│Durrës│Vlorë│Shkodër│Korçë│Sarandë│Prishtina│Kostur│Athens│Rome│Zurich...    │
# │  :9101  :9102  :9103  :9104  :9105   :9106  :9107   :9108     :9109  :9110  :9111 :9112        │
# └────────────────────────────────────────────────────────────────────────────────────────────────┘
# 
# ┌────────────────────────────────────────────────────────────────────────────────────────────────┐
# │                           14 PERSONAS (Specialist Module)                                      │
# │  medical│iot│security│architect│science│industrial│agi│business│human│academic│media│culture│hobby│entertainment │
# │                              Single Container :9200                                            │
# └────────────────────────────────────────────────────────────────────────────────────────────────┘
# 
# ┌────────────────────────────────────────────────────────────────────────────────────────────────┐
# │                   AGIEM + DATA SOURCES (Per Continent + India + China)                         │
# │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐           │
# │  │  AGIEM   │  │ Europe   │  │ Americas │  │ Asia+CN  │  │ India+SA │  │ Africa   │           │
# │  │  :9300   │  │  :9301   │  │  :9302   │  │  :9303   │  │  :9304   │  │  :9305   │           │
# │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘           │
# └────────────────────────────────────────────────────────────────────────────────────────────────┘
# 
# ═══════════════════════════════════════════════════════════════════════════════════════════════════

version: '3.9'

x-healthcheck-defaults: &healthcheck-defaults
  interval: 30s
  timeout: 10s
  retries: 3
  start_period: 10s

x-python-defaults: &python-defaults
  restart: unless-stopped
  environment: &python-env
    PYTHONUNBUFFERED: "1"
    REDIS_URL: "redis://redis:6379/0"
    POSTGRES_URL: "postgresql://clisonix:clisonix@postgres:5432/clisonixdb"

services:
  # ═══════════════════════════════════════════════════════════════════════════════
  # DATABASES & INFRASTRUCTURE
  # ═══════════════════════════════════════════════════════════════════════════════
  
  postgres:
    image: postgres:16-alpine
    container_name: clisonix-postgres
    environment:
      POSTGRES_USER: clisonix
      POSTGRES_PASSWORD: clisonix
      POSTGRES_DB: clisonixdb
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD-SHELL", "pg_isready -U clisonix"]
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    container_name: clisonix-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "redis-cli", "ping"]
    restart: unless-stopped

  neo4j:
    image: neo4j:5-community
    container_name: clisonix-neo4j
    environment:
      NEO4J_AUTH: neo4j/clisonix123
    ports:
      - "7474:7474"
      - "7687:7687"
    volumes:
      - neo4j_data:/data
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD-SHELL", "wget --no-verbose --tries=1 --spider http://localhost:7474 || exit 1"]
    restart: unless-stopped

  victoriametrics:
    image: victoriametrics/victoria-metrics:v1.96.0
    container_name: clisonix-victoriametrics
    ports:
      - "8428:8428"
    volumes:
      - victoriametrics_data:/victoria-metrics-data
    command:
      - "-storageDataPath=/victoria-metrics-data"
      - "-retentionPeriod=12"
      - "-httpListenAddr=0.0.0.0:8428"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://127.0.0.1:8428/health"]
    restart: unless-stopped

  # ═══════════════════════════════════════════════════════════════════════════════
  # LIAM - Labor Intelligence Array Matrix (Binary Algebra)
  # ═══════════════════════════════════════════════════════════════════════════════
  
  liam:
    build:
      context: .
      dockerfile: Dockerfile.liam
    container_name: clisonix-liam
    <<: *python-defaults
    environment:
      <<: *python-env
      LIAM_PORT: "8062"
    ports:
      - "8062:8062"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8062/health"]
    labels:
      clisonix.role: "binary-algebra"
      clisonix.component: "liam"
      clisonix.description: "Labor Intelligence Array Matrix - No Loops Philosophy"

  # ═══════════════════════════════════════════════════════════════════════════════
  # ALDA - Artificial Labor Determined Array
  # ═══════════════════════════════════════════════════════════════════════════════
  
  alda:
    build:
      context: .
      dockerfile: Dockerfile.alda
    container_name: clisonix-alda
    <<: *python-defaults
    environment:
      <<: *python-env
      ALDA_PORT: "8063"
    ports:
      - "8063:8063"
    depends_on:
      redis:
        condition: service_healthy
      liam:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8063/health"]
    labels:
      clisonix.role: "labor-orchestration"
      clisonix.component: "alda"
      clisonix.description: "Artificial Labor Determined Array - Deterministic Scheduling"

  # ═══════════════════════════════════════════════════════════════════════════════
  # ASI TRINITY - The Core Intelligence Stack
  # Alba (Data Collector) → Albi (Learner) → Jona (Sandbox) → ASI (Combined)
  # ═══════════════════════════════════════════════════════════════════════════════
  
  alba:
    build:
      context: .
      dockerfile: Dockerfile.alba
    container_name: clisonix-alba
    <<: *python-defaults
    ports:
      - "5555:5555"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:5555/health"]
    labels:
      clisonix.role: "asi-trinity"
      clisonix.component: "alba"
      clisonix.description: "Data Collection & Signal Processing"

  albi:
    build:
      context: .
      dockerfile: Dockerfile.albi
    container_name: clisonix-albi
    <<: *python-defaults
    ports:
      - "6680:6680"
    depends_on:
      redis:
        condition: service_healthy
      alba:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:6680/health"]
    labels:
      clisonix.role: "asi-trinity"
      clisonix.component: "albi"
      clisonix.description: "Adaptive Learning & Analytics"

  jona:
    build:
      context: .
      dockerfile: Dockerfile.jona
    container_name: clisonix-jona
    <<: *python-defaults
    environment:
      <<: *python-env
      JONA_MODE: "sandbox"
      JONA_SAFE_MODE: "true"
    ports:
      - "7777:7777"
    depends_on:
      redis:
        condition: service_healthy
      alba:
        condition: service_healthy
      albi:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:7777/health"]
    labels:
      clisonix.role: "asi-trinity"
      clisonix.component: "jona"
      clisonix.description: "Sandbox & Synthesis Coordinator"

  asi:
    build:
      context: .
      dockerfile: Dockerfile.asi
    container_name: clisonix-asi
    <<: *python-defaults
    environment:
      <<: *python-env
      ALBA_URL: "http://alba:5555"
      ALBI_URL: "http://albi:6680"
      JONA_URL: "http://jona:7777"
    ports:
      - "9094:9094"
    depends_on:
      alba:
        condition: service_healthy
      albi:
        condition: service_healthy
      jona:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9094/health"]
    labels:
      clisonix.role: "asi-trinity"
      clisonix.component: "asi"
      clisonix.description: "Artificial Super Intelligence (Combined)"

  # ═══════════════════════════════════════════════════════════════════════════════
  # OCEAN CORE - Knowledge Engine & Curiosity AI
  # ═══════════════════════════════════════════════════════════════════════════════
  
  ocean-core:
    build:
      context: ./ocean-core
      dockerfile: Dockerfile
    container_name: clisonix-ocean-core
    <<: *python-defaults
    environment:
      <<: *python-env
      OCEAN_PORT: "8030"
      ALPHABET_URL: "http://alphabet-layers:8061"
      ALPHABET_BINARY: "true"
    ports:
      - "8030:8030"
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      alphabet-layers:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8030/health"]
    labels:
      clisonix.role: "core"
      clisonix.component: "ocean-core"
      clisonix.description: "Knowledge Engine connected to Alphabet Layers"

  # ═══════════════════════════════════════════════════════════════════════════════
  # ALPHABET LAYERS - Binary Mathematical Engine (CBOR2/MessagePack)
  # ═══════════════════════════════════════════════════════════════════════════════
  
  alphabet-layers:
    build:
      context: .
      dockerfile: Dockerfile.alphabet
    container_name: clisonix-alphabet-layers
    <<: *python-defaults
    environment:
      <<: *python-env
      ALPHABET_PORT: "8061"
      BINARY_ONLY: "true"
    ports:
      - "8061:8061"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8061/health"]
    labels:
      clisonix.role: "core"
      clisonix.component: "alphabet-layers"
      clisonix.description: "61 Mathematical Layers - BINARY ONLY (CBOR2/MessagePack)"
      clisonix.protocol: "binary"

  # ═══════════════════════════════════════════════════════════════════════════════
  # ALBA IDLE - Technical Status Chat Interface
  # ═══════════════════════════════════════════════════════════════════════════════
  
  alba-idle:
    build:
      context: .
      dockerfile: Dockerfile.alba-idle
    container_name: clisonix-alba-idle
    <<: *python-defaults
    environment:
      <<: *python-env
      ALBA_URL: "http://alba:5555"
      ALBI_URL: "http://albi:6680"
      JONA_URL: "http://jona:7777"
      ASI_URL: "http://asi:9094"
      OCEAN_URL: "http://ocean-core:8030"
    ports:
      - "8031:8031"
    depends_on:
      ocean-core:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8031/health"]
    labels:
      clisonix.role: "monitoring"
      clisonix.component: "alba-idle"
      clisonix.description: "Technical Status Chat for System Monitoring"

  # ═══════════════════════════════════════════════════════════════════════════════
  # BLERINA - Document Intelligence & Narrative Engine
  # ═══════════════════════════════════════════════════════════════════════════════
  
  blerina:
    build:
      context: .
      dockerfile: Dockerfile.blerina
    container_name: clisonix-blerina
    <<: *python-defaults
    environment:
      <<: *python-env
      YOUTUBE_API_KEY: "${YOUTUBE_API_KEY:-}"
    ports:
      - "8035:8035"
    depends_on:
      redis:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8035/health"]
    labels:
      clisonix.role: "intelligence"
      clisonix.component: "blerina"
      clisonix.description: "Document Intelligence & Narrative Generation"

  # ═══════════════════════════════════════════════════════════════════════════════
  # 14 PERSONAS - Specialist Modules (Single Container)
  # ═══════════════════════════════════════════════════════════════════════════════
  
  personas:
    build:
      context: .
      dockerfile: Dockerfile.personas
    container_name: clisonix-personas
    <<: *python-defaults
    environment:
      <<: *python-env
      PERSONA_COUNT: "14"
      PERSONAS_ENABLED: "medical_science,lora_iot,security,systems_architecture,natural_science,industrial_process,agi_analyst,business_analyst,smart_human,academic,media,culture,hobby,entertainment"
    ports:
      - "9200:9200"
    depends_on:
      redis:
        condition: service_healthy
      ocean-core:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9200/health"]
    labels:
      clisonix.role: "specialists"
      clisonix.component: "personas"
      clisonix.description: "14 Specialist Personas (Medical, IoT, Security, etc.)"

  # ═══════════════════════════════════════════════════════════════════════════════
  # AGIEM - Artificial General Enhanced Intelligence Manager
  # Connected to Scalable Managers + Open Free Data Sources
  # ═══════════════════════════════════════════════════════════════════════════════
  
  agiem:
    build:
      context: .
      dockerfile: Dockerfile.agiem
    container_name: clisonix-agiem
    <<: *python-defaults
    environment:
      <<: *python-env
      AGIEM_MODE: "production"
      DATA_SOURCES_ENABLED: "europe,americas,asia_china,india_south_asia,africa_middle_east,oceania"
    ports:
      - "9300:9300"
    depends_on:
      redis:
        condition: service_healthy
      alba:
        condition: service_healthy
      albi:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9300/health"]
    labels:
      clisonix.role: "manager"
      clisonix.component: "agiem"
      clisonix.description: "AGI Ecosystem Manager"

  # ═══════════════════════════════════════════════════════════════════════════════
  # DATA SOURCE CONTAINERS - Per Continent + India + China
  # ═══════════════════════════════════════════════════════════════════════════════
  
  datasource-europe:
    build:
      context: .
      dockerfile: Dockerfile.datasource
    container_name: clisonix-datasource-europe
    <<: *python-defaults
    environment:
      <<: *python-env
      DATASOURCE_REGION: "europe"
      DATASOURCE_SOURCES: "europe_sources,eastern_europe_balkans_sources"
    ports:
      - "9301:9301"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9301/health"]
    labels:
      clisonix.role: "datasource"
      clisonix.region: "europe"

  datasource-americas:
    build:
      context: .
      dockerfile: Dockerfile.datasource
    container_name: clisonix-datasource-americas
    <<: *python-defaults
    environment:
      <<: *python-env
      DATASOURCE_REGION: "americas"
      DATASOURCE_SOURCES: "americas_sources,caribbean_central_america_sources"
    ports:
      - "9302:9302"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9302/health"]
    labels:
      clisonix.role: "datasource"
      clisonix.region: "americas"

  datasource-asia-china:
    build:
      context: .
      dockerfile: Dockerfile.datasource
    container_name: clisonix-datasource-asia-china
    <<: *python-defaults
    environment:
      <<: *python-env
      DATASOURCE_REGION: "asia_china"
      DATASOURCE_SOURCES: "asia_china_sources,asia_oceania_global_sources"
    ports:
      - "9303:9303"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9303/health"]
    labels:
      clisonix.role: "datasource"
      clisonix.region: "asia_china"

  datasource-india-south-asia:
    build:
      context: .
      dockerfile: Dockerfile.datasource
    container_name: clisonix-datasource-india
    <<: *python-defaults
    environment:
      <<: *python-env
      DATASOURCE_REGION: "india_south_asia"
      DATASOURCE_SOURCES: "india_south_asia_sources"
    ports:
      - "9304:9304"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9304/health"]
    labels:
      clisonix.role: "datasource"
      clisonix.region: "india_south_asia"

  datasource-africa-middle-east:
    build:
      context: .
      dockerfile: Dockerfile.datasource
    container_name: clisonix-datasource-africa
    <<: *python-defaults
    environment:
      <<: *python-env
      DATASOURCE_REGION: "africa_middle_east"
      DATASOURCE_SOURCES: "africa_middle_east_sources"
    ports:
      - "9305:9305"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9305/health"]
    labels:
      clisonix.role: "datasource"
      clisonix.region: "africa_middle_east"

  datasource-oceania-pacific:
    build:
      context: .
      dockerfile: Dockerfile.datasource
    container_name: clisonix-datasource-oceania
    <<: *python-defaults
    environment:
      <<: *python-env
      DATASOURCE_REGION: "oceania_pacific"
      DATASOURCE_SOURCES: "pacific_islands_sources,asia_oceania_global_sources"
    ports:
      - "9306:9306"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9306/health"]
    labels:
      clisonix.role: "datasource"
      clisonix.region: "oceania_pacific"

  datasource-central-asia:
    build:
      context: .
      dockerfile: Dockerfile.datasource
    container_name: clisonix-datasource-central-asia
    <<: *python-defaults
    environment:
      <<: *python-env
      DATASOURCE_REGION: "central_asia"
      DATASOURCE_SOURCES: "central_asia_caucasus_sources"
    ports:
      - "9307:9307"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9307/health"]
    labels:
      clisonix.role: "datasource"
      clisonix.region: "central_asia"

  # ═══════════════════════════════════════════════════════════════════════════════
  # 23 LABORATORIES - City-Named Research Labs
  # ═══════════════════════════════════════════════════════════════════════════════
  
  # ALBANIA LABS (7)
  lab-elbasan:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-elbasan
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Elbasan_AI"
      LAB_NAME: "Elbasan AI Lab"
      LAB_FUNCTION: "Artificial Intelligence & Machine Learning"
      LAB_LOCATION: "Elbasan, Albania"
      LAB_TYPE: "AI"
      LAB_PORT: "9101"
    ports:
      - "9101:9101"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9101/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "elbasan"
      clisonix.country: "albania"

  lab-tirana:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-tirana
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Tirana_Medical"
      LAB_NAME: "Tirana Medical Lab"
      LAB_FUNCTION: "Medical Research & Bioscience"
      LAB_LOCATION: "Tirana, Albania"
      LAB_TYPE: "Medical"
      LAB_PORT: "9102"
    ports:
      - "9102:9102"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9102/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "tirana"
      clisonix.country: "albania"

  lab-durres:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-durres
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Durres_IoT"
      LAB_NAME: "Durrës IoT Lab"
      LAB_FUNCTION: "Internet of Things & Sensor Networks"
      LAB_LOCATION: "Durrës, Albania"
      LAB_TYPE: "IoT"
      LAB_PORT: "9103"
    ports:
      - "9103:9103"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9103/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "durres"
      clisonix.country: "albania"

  lab-vlore:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-vlore
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Vlore_Environmental"
      LAB_NAME: "Vlorë Environmental Lab"
      LAB_FUNCTION: "Environmental Monitoring & Ecology"
      LAB_LOCATION: "Vlorë, Albania"
      LAB_TYPE: "Environmental"
      LAB_PORT: "9104"
    ports:
      - "9104:9104"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9104/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "vlore"
      clisonix.country: "albania"

  lab-shkoder:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-shkoder
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Shkoder_Marine"
      LAB_NAME: "Shkodër Marine Lab"
      LAB_FUNCTION: "Marine Biology & Oceanography"
      LAB_LOCATION: "Shkodër, Albania"
      LAB_TYPE: "Marine"
      LAB_PORT: "9105"
    ports:
      - "9105:9105"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9105/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "shkoder"
      clisonix.country: "albania"

  lab-korce:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-korce
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Korce_Agricultural"
      LAB_NAME: "Korça Agricultural Lab"
      LAB_FUNCTION: "Agricultural Sciences & Crop Analysis"
      LAB_LOCATION: "Korça, Albania"
      LAB_TYPE: "Agricultural"
      LAB_PORT: "9106"
    ports:
      - "9106:9106"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9106/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "korce"
      clisonix.country: "albania"

  lab-saranda:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-saranda
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Sarrande_Underwater"
      LAB_NAME: "Sarandë Underwater Lab"
      LAB_FUNCTION: "Underwater Exploration & Deep Sea Research"
      LAB_LOCATION: "Sarandë, Albania"
      LAB_TYPE: "Underwater"
      LAB_PORT: "9107"
    ports:
      - "9107:9107"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9107/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "saranda"
      clisonix.country: "albania"

  # KOSOVO LAB (1)
  lab-prishtina:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-prishtina
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Prishtina_Security"
      LAB_NAME: "Prishtina Security Lab"
      LAB_FUNCTION: "Cybersecurity & Network Protection"
      LAB_LOCATION: "Prishtina, Kosovo"
      LAB_TYPE: "Security"
      LAB_PORT: "9108"
    ports:
      - "9108:9108"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9108/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "prishtina"
      clisonix.country: "kosovo"

  # NORTH MACEDONIA LAB (1)
  lab-kostur:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-kostur
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Kostur_Energy"
      LAB_NAME: "Kostur Energy Lab"
      LAB_FUNCTION: "Renewable Energy & Power Systems"
      LAB_LOCATION: "Kostur, North Macedonia"
      LAB_TYPE: "Energy"
      LAB_PORT: "9109"
    ports:
      - "9109:9109"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9109/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "kostur"
      clisonix.country: "north_macedonia"

  # GREECE LAB (1)
  lab-athens:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-athens
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Athens_Classical"
      LAB_NAME: "Athens Classical Lab"
      LAB_FUNCTION: "Classical Studies & Historical Research"
      LAB_LOCATION: "Athens, Greece"
      LAB_TYPE: "Academic"
      LAB_PORT: "9110"
    ports:
      - "9110:9110"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9110/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "athens"
      clisonix.country: "greece"

  # ITALY LAB (1)
  lab-rome:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-rome
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Rome_Architecture"
      LAB_NAME: "Rome Architecture Lab"
      LAB_FUNCTION: "Architectural Engineering & Design"
      LAB_LOCATION: "Rome, Italy"
      LAB_TYPE: "Architecture"
      LAB_PORT: "9111"
    ports:
      - "9111:9111"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9111/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "rome"
      clisonix.country: "italy"

  # SWITZERLAND LAB (1)
  lab-zurich:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-zurich
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Zurich_Finance"
      LAB_NAME: "Zurich Finance Lab"
      LAB_FUNCTION: "Financial Analysis & Blockchain"
      LAB_LOCATION: "Zurich, Switzerland"
      LAB_TYPE: "Finance"
      LAB_PORT: "9112"
    ports:
      - "9112:9112"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9112/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "zurich"
      clisonix.country: "switzerland"

  # SERBIA LAB (1)
  lab-beograd:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-beograd
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Beograd_Industrial"
      LAB_NAME: "Beograd Industrial Lab"
      LAB_FUNCTION: "Industrial Process Optimization"
      LAB_LOCATION: "Beograd, Serbia"
      LAB_TYPE: "Industrial"
      LAB_PORT: "9113"
    ports:
      - "9113:9113"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9113/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "beograd"
      clisonix.country: "serbia"

  # BULGARIA LAB (1)
  lab-sofia:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-sofia
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Sofia_Chemistry"
      LAB_NAME: "Sofia Chemistry Lab"
      LAB_FUNCTION: "Chemical Research & Material Science"
      LAB_LOCATION: "Sofia, Bulgaria"
      LAB_TYPE: "Chemistry"
      LAB_PORT: "9114"
    ports:
      - "9114:9114"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9114/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "sofia"
      clisonix.country: "bulgaria"

  # CROATIA LAB (1)
  lab-zagreb:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-zagreb
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Zagreb_Biotech"
      LAB_NAME: "Zagreb Biotech Lab"
      LAB_FUNCTION: "Biotechnology & Genetic Engineering"
      LAB_LOCATION: "Zagreb, Croatia"
      LAB_TYPE: "Biotech"
      LAB_PORT: "9115"
    ports:
      - "9115:9115"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9115/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "zagreb"
      clisonix.country: "croatia"

  # SLOVENIA LAB (1)
  lab-ljubljana:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-ljubljana
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Ljubljana_Quantum"
      LAB_NAME: "Ljubljana Quantum Lab"
      LAB_FUNCTION: "Quantum Computing & Physics"
      LAB_LOCATION: "Ljubljana, Slovenia"
      LAB_TYPE: "Quantum"
      LAB_PORT: "9116"
    ports:
      - "9116:9116"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9116/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "ljubljana"
      clisonix.country: "slovenia"

  # AUSTRIA LAB (1)
  lab-vienna:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-vienna
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Vienna_Neuroscience"
      LAB_NAME: "Vienna Neuroscience Lab"
      LAB_FUNCTION: "Neuroscience & Brain Research"
      LAB_LOCATION: "Vienna, Austria"
      LAB_TYPE: "Neuroscience"
      LAB_PORT: "9117"
    ports:
      - "9117:9117"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9117/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "vienna"
      clisonix.country: "austria"

  # CZECH REPUBLIC LAB (1)
  lab-prague:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-prague
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Prague_Robotics"
      LAB_NAME: "Prague Robotics Lab"
      LAB_FUNCTION: "Robotics & Automation Systems"
      LAB_LOCATION: "Prague, Czech Republic"
      LAB_TYPE: "Robotics"
      LAB_PORT: "9118"
    ports:
      - "9118:9118"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9118/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "prague"
      clisonix.country: "czech_republic"

  # HUNGARY LAB (1)
  lab-budapest:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-budapest
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Budapest_Data"
      LAB_NAME: "Budapest Data Lab"
      LAB_FUNCTION: "Big Data Analytics & Visualization"
      LAB_LOCATION: "Budapest, Hungary"
      LAB_TYPE: "Data"
      LAB_PORT: "9119"
    ports:
      - "9119:9119"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9119/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "budapest"
      clisonix.country: "hungary"

  # ROMANIA LAB (1)
  lab-bucharest:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-bucharest
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Bucharest_Nanotechnology"
      LAB_NAME: "Bucharest Nanotechnology Lab"
      LAB_FUNCTION: "Nanotechnology & Nanomaterials"
      LAB_LOCATION: "Bucharest, Romania"
      LAB_TYPE: "Nanotechnology"
      LAB_PORT: "9120"
    ports:
      - "9120:9120"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9120/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "bucharest"
      clisonix.country: "romania"

  # TURKEY LAB (1)
  lab-istanbul:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-istanbul
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Istanbul_Trade"
      LAB_NAME: "Istanbul Trade Lab"
      LAB_FUNCTION: "International Trade & Logistics"
      LAB_LOCATION: "Istanbul, Turkey"
      LAB_TYPE: "Trade"
      LAB_PORT: "9121"
    ports:
      - "9121:9121"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9121/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "istanbul"
      clisonix.country: "turkey"

  # EGYPT LAB (1)
  lab-cairo:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-cairo
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Cairo_Archeology"
      LAB_NAME: "Cairo Archeology Lab"
      LAB_FUNCTION: "Archeological Research & Preservation"
      LAB_LOCATION: "Cairo, Egypt"
      LAB_TYPE: "Archeology"
      LAB_PORT: "9122"
    ports:
      - "9122:9122"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9122/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "cairo"
      clisonix.country: "egypt"

  # ISRAEL LAB (1)
  lab-jerusalem:
    build:
      context: .
      dockerfile: Dockerfile.lab
    container_name: clisonix-lab-jerusalem
    <<: *python-defaults
    environment:
      <<: *python-env
      LAB_ID: "Jerusalem_Heritage"
      LAB_NAME: "Jerusalem Heritage Lab"
      LAB_FUNCTION: "Cultural Heritage & Restoration"
      LAB_LOCATION: "Jerusalem, Palestine"
      LAB_TYPE: "Heritage"
      LAB_PORT: "9123"
    ports:
      - "9123:9123"
    depends_on:
      agiem:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9123/health"]
    labels:
      clisonix.role: "laboratory"
      clisonix.city: "jerusalem"
      clisonix.country: "palestine"

  # ═══════════════════════════════════════════════════════════════════════════════
  # SaaS API PRODUCTION SERVICES
  # ═══════════════════════════════════════════════════════════════════════════════
  
  saas-api:
    build:
      context: .
      dockerfile: Dockerfile.saas
    container_name: clisonix-saas-api
    <<: *python-defaults
    environment:
      <<: *python-env
      SAAS_MODE: "production"
      ASI_URL: "http://asi:9094"
      ALBA_URL: "http://alba:5555"
      ALBI_URL: "http://albi:6680"
      JONA_URL: "http://jona:7777"
    ports:
      - "8040:8040"
    depends_on:
      asi:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8040/health"]
    labels:
      clisonix.role: "saas"
      clisonix.component: "api"
      clisonix.description: "SaaS Production API"

  # ═══════════════════════════════════════════════════════════════════════════════
  # MARKETPLACE (API Keys, Billing)
  # ═══════════════════════════════════════════════════════════════════════════════
  
  marketplace:
    build:
      context: .
      dockerfile: Dockerfile.marketplace
    container_name: clisonix-marketplace
    <<: *python-defaults
    environment:
      <<: *python-env
      STRIPE_SECRET_KEY: "${STRIPE_SECRET_KEY:-}"
      STRIPE_PUBLISHABLE_KEY: "${STRIPE_PUBLISHABLE_KEY:-}"
      STRIPE_WEBHOOK_SECRET: "${STRIPE_WEBHOOK_SECRET:-}"
    ports:
      - "8004:8004"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8004/health"]
    labels:
      clisonix.role: "saas"
      clisonix.component: "marketplace"

  # ═══════════════════════════════════════════════════════════════════════════════
  # REPORTING & EXCEL SERVICES
  # ═══════════════════════════════════════════════════════════════════════════════
  
  reporting:
    build:
      context: .
      dockerfile: Dockerfile.reporting
    container_name: clisonix-reporting
    <<: *python-defaults
    ports:
      - "8001:8001"
    volumes:
      - reports_data:/app/reports
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8001/health"]
    labels:
      clisonix.role: "services"
      clisonix.component: "reporting"

  excel:
    build:
      context: ./services/excel
      dockerfile: Dockerfile
    container_name: clisonix-excel
    <<: *python-defaults
    ports:
      - "8002:8002"
    volumes:
      - excel_data:/app/excel_files
      - uploads_data:/app/uploads
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8002/health"]
    labels:
      clisonix.role: "services"
      clisonix.component: "excel"

  # ═══════════════════════════════════════════════════════════════════════════════
  # BEHAVIORAL SCIENCE & ECONOMY
  # ═══════════════════════════════════════════════════════════════════════════════
  
  behavioral:
    build:
      context: .
      dockerfile: Dockerfile.behavioral
    container_name: clisonix-behavioral
    <<: *python-defaults
    ports:
      - "8003:8003"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8003/health"]
    labels:
      clisonix.role: "services"
      clisonix.component: "behavioral"

  economy:
    build:
      context: .
      dockerfile: Dockerfile.economy
    container_name: clisonix-economy
    <<: *python-defaults
    environment:
      <<: *python-env
      ECONOMY_API_PORT: "9093"
    ports:
      - "9093:9093"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:9093/health"]
    labels:
      clisonix.role: "services"
      clisonix.component: "economy"

  # ═══════════════════════════════════════════════════════════════════════════════
  # AVIATION WEATHER (Special Microservice)
  # ═══════════════════════════════════════════════════════════════════════════════
  
  aviation:
    build:
      context: ./services/aviation-weather
      dockerfile: Dockerfile
    container_name: clisonix-aviation
    environment:
      PYTHONUNBUFFERED: "1"
      AVIATION_PORT: "8080"
      AVWX_API_KEY: "${AVWX_API_KEY:-}"
      CHECKWX_API_KEY: "${CHECKWX_API_KEY:-}"
    ports:
      - "8080:8080"
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
    restart: unless-stopped
    labels:
      clisonix.role: "services"
      clisonix.component: "aviation"

  # ═══════════════════════════════════════════════════════════════════════════════
  # FRONTEND & API GATEWAY
  # ═══════════════════════════════════════════════════════════════════════════════
  
  api:
    build:
      context: ./apps/api
      dockerfile: Dockerfile
    container_name: clisonix-api
    <<: *python-defaults
    environment:
      <<: *python-env
      DATABASE_URL: "postgresql://clisonix:clisonix@postgres:5432/clisonixdb"
    ports:
      - "8000:8000"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    healthcheck:
      <<: *healthcheck-defaults
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
    labels:
      clisonix.role: "gateway"
      clisonix.component: "api"

  web:
    build:
      context: ./apps/web
      dockerfile: Dockerfile
    container_name: clisonix-web
    environment:
      NODE_ENV: "production"
      API_INTERNAL_URL: "http://clisonix-api:8000"
      NEXT_PUBLIC_API_BASE: "/api"
    ports:
      - "3000:3000"
    depends_on:
      api:
        condition: service_healthy
    restart: unless-stopped
    labels:
      clisonix.role: "frontend"
      clisonix.component: "web"

# ═══════════════════════════════════════════════════════════════════════════════════════════════════
# VOLUMES
# ═══════════════════════════════════════════════════════════════════════════════════════════════════

volumes:
  postgres_data:
    driver: local
  redis_data:
    driver: local
  neo4j_data:
    driver: local
  victoriametrics_data:
    driver: local
  reports_data:
    driver: local
  excel_data:
    driver: local
  uploads_data:
    driver: local

# ═══════════════════════════════════════════════════════════════════════════════════════════════════
# NETWORKS
# ═══════════════════════════════════════════════════════════════════════════════════════════════════

networks:
  default:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.28.0.0/16
