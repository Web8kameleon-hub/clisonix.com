{
  "n8n_workflows": {
    "metadata": {
      "title": "Clisonix Cloud - n8n Workflow Templates",
      "description": "Ready-to-use n8n workflows for Clisonix monitoring and automation",
      "date_created": "2025-12-10",
      "version": "1.0",
      "instructions": "Import these workflows into n8n by: Settings â†’ Import â†’ Paste JSON"
    },
    "workflows": [
      {
        "id": "workflow_eeg_anomaly_alert",
        "name": "EEG Anomaly Detection & Alert",
        "description": "Monitor ALBI EEG metrics and alert when anomalies detected",
        "trigger": "Every 5 minutes",
        "nodes": [
          {
            "name": "Cron Trigger",
            "type": "n8n-nodes-base.cron",
            "config": {
              "mode": "every",
              "expression": "*/5 * * * *",
              "description": "Every 5 minutes"
            }
          },
          {
            "name": "Fetch Clisonix Status",
            "type": "n8n-nodes-base.httpRequest",
            "config": {
              "method": "GET",
              "url": "http://localhost:8000/api/asi/status",
              "responseFormat": "json"
            }
          },
          {
            "name": "Extract ALBI EEG Metrics",
            "type": "n8n-nodes-base.set",
            "config": {
              "alpha_band": "{{ $node['Fetch Clisonix Status'].json.asi.albi.eeg_metrics.alpha }}",
              "theta_band": "{{ $node['Fetch Clisonix Status'].json.asi.albi.eeg_metrics.theta }}",
              "beta_band": "{{ $node['Fetch Clisonix Status'].json.asi.albi.eeg_metrics.beta }}"
            }
          },
          {
            "name": "Check Anomaly Threshold",
            "type": "n8n-nodes-base.if",
            "config": {
              "condition": "{{ $node['Extract ALBI EEG Metrics'].json.alpha_band > 2.0 || $node['Extract ALBI EEG Metrics'].json.theta_band < 0.5 }}",
              "description": "Trigger alert if alpha > 2.0 OR theta < 0.5"
            }
          },
          {
            "name": "Call Claude Interpretation",
            "type": "n8n-nodes-base.httpRequest",
            "config": {
              "method": "POST",
              "url": "http://localhost:8000/api/ai/quick-interpret",
              "headers": {
                "Content-Type": "application/json"
              },
              "body": {
                "query": "Analyze these EEG anomalies: alpha={{ $node['Extract ALBI EEG Metrics'].json.alpha_band }}, theta={{ $node['Extract ALBI EEG Metrics'].json.theta_band }}"
              }
            }
          },
          {
            "name": "Send Slack Alert",
            "type": "n8n-nodes-base.slack",
            "config": {
              "channel": "#clisonix-alerts",
              "text": "ðŸš¨ **EEG Anomaly Detected**\n\nAlpha: {{ $node['Extract ALBI EEG Metrics'].json.alpha_band }}\nTheta: {{ $node['Extract ALBI EEG Metrics'].json.theta_band }}\n\n**AI Analysis:**\n{{ $node['Call Claude Interpretation'].json.interpretation }}"
            }
          },
          {
            "name": "Log to Database",
            "type": "n8n-nodes-base.postgres",
            "config": {
              "operation": "insert",
              "table": "eeg_anomalies",
              "values": {
                "timestamp": "{{ new Date().toISOString() }}",
                "alpha_band": "{{ $node['Extract ALBI EEG Metrics'].json.alpha_band }}",
                "theta_band": "{{ $node['Extract ALBI EEG Metrics'].json.theta_band }}",
                "interpretation": "{{ $node['Call Claude Interpretation'].json.interpretation }}"
              }
            }
          }
        ]
      },
      {
        "id": "workflow_prometheus_threshold_monitor",
        "name": "Prometheus Threshold Monitoring",
        "description": "Monitor Prometheus metrics and alert on threshold violations",
        "trigger": "Every 10 minutes",
        "nodes": [
          {
            "name": "Cron Trigger",
            "type": "n8n-nodes-base.cron",
            "config": {
              "mode": "every",
              "expression": "*/10 * * * *",
              "description": "Every 10 minutes"
            }
          },
          {
            "name": "Query Prometheus",
            "type": "n8n-nodes-base.httpRequest",
            "config": {
              "method": "GET",
              "url": "http://localhost:9090/api/v1/query",
              "queryParameters": {
                "query": "rate(alba_requests_total[5m])"
              },
              "responseFormat": "json"
            }
          },
          {
            "name": "Check CPU Threshold",
            "type": "n8n-nodes-base.if",
            "config": {
              "condition": "{{ $node['Query Prometheus'].json.data.result[0].value[1] > 100 }}",
              "description": "Alert if request rate > 100 req/s"
            }
          },
          {
            "name": "Send PagerDuty Alert",
            "type": "n8n-nodes-base.httpRequest",
            "config": {
              "method": "POST",
              "url": "https://events.pagerduty.com/v2/enqueue",
              "headers": {
                "Content-Type": "application/json"
              },
              "body": {
                "routing_key": "{{ env.PAGERDUTY_KEY }}",
                "event_action": "trigger",
                "payload": {
                  "summary": "Clisonix: High request rate detected",
                  "severity": "critical",
                  "source": "n8n-clisonix-monitor",
                  "custom_details": {
                    "current_rate": "{{ $node['Query Prometheus'].json.data.result[0].value[1] }}",
                    "threshold": 100,
                    "service": "alba"
                  }
                }
              }
            }
          }
        ]
      },
      {
        "id": "workflow_daily_health_report",
        "name": "Daily Clisonix Health Report",
        "description": "Generate and email daily health report every morning",
        "trigger": "Every day at 8 AM",
        "nodes": [
          {
            "name": "Cron Trigger",
            "type": "n8n-nodes-base.cron",
            "config": {
              "mode": "custom",
              "expression": "0 8 * * *",
              "description": "Every day at 8:00 AM"
            }
          },
          {
            "name": "Fetch System Health",
            "type": "n8n-nodes-base.httpRequest",
            "config": {
              "method": "GET",
              "url": "http://localhost:8000/api/asi/health",
              "responseFormat": "json"
            }
          },
          {
            "name": "Get Prometheus Summary",
            "type": "n8n-nodes-base.httpRequest",
            "config": {
              "method": "GET",
              "url": "http://localhost:9090/api/v1/query",
              "queryParameters": {
                "query": "up{job='clisonix'}"
              },
              "responseFormat": "json"
            }
          },
          {
            "name": "Call CrewAI Trinity Analysis",
            "type": "n8n-nodes-base.httpRequest",
            "config": {
              "method": "POST",
              "url": "http://localhost:8000/api/ai/trinity-analysis",
              "body": {
                "query": "Generate a comprehensive daily health summary for all ASI Trinity components",
                "detailed": true
              },
              "responseFormat": "json"
            }
          },
          {
            "name": "Format HTML Report",
            "type": "n8n-nodes-base.set",
            "config": {
              "html_report": "{{ `<h1>Clisonix Daily Health Report</h1><p>Generated: {{ new Date().toISOString() }}</p><h2>System Status</h2><pre>${JSON.stringify($node['Fetch System Health'].json, null, 2)}</pre><h2>AI Trinity Analysis</h2><pre>${JSON.stringify($node['Call CrewAI Trinity Analysis'].json, null, 2)}</pre>` }}"
            }
          },
          {
            "name": "Send Email Report",
            "type": "n8n-nodes-base.emailSendGmail",
            "config": {
              "to": "{{ env.REPORT_EMAIL }}",
              "subject": "Clisonix Daily Health Report - {{ new Date().toLocaleDateString() }}",
              "html": "{{ $node['Format HTML Report'].json.html_report }}"
            }
          },
          {
            "name": "Save Report to Database",
            "type": "n8n-nodes-base.postgres",
            "config": {
              "operation": "insert",
              "table": "health_reports",
              "values": {
                "date": "{{ new Date().toISOString().split('T')[0] }}",
                "system_health": "{{ JSON.stringify($node['Fetch System Health'].json) }}",
                "prometheus_summary": "{{ JSON.stringify($node['Get Prometheus Summary'].json) }}",
                "trinity_analysis": "{{ JSON.stringify($node['Call CrewAI Trinity Analysis'].json) }}"
              }
            }
          }
        ]
      },
      {
        "id": "workflow_auto_scaling_trigger",
        "name": "Auto-Scaling Trigger",
        "description": "Automatically scale services based on Prometheus metrics",
        "trigger": "Every 30 seconds",
        "nodes": [
          {
            "name": "High Frequency Monitor",
            "type": "n8n-nodes-base.cron",
            "config": {
              "mode": "every",
              "expression": "*/0.5 * * * * *",
              "description": "Every 30 seconds"
            }
          },
          {
            "name": "Check Current Load",
            "type": "n8n-nodes-base.httpRequest",
            "config": {
              "method": "GET",
              "url": "http://localhost:9090/api/v1/query",
              "queryParameters": {
                "query": "avg(rate(alba_requests_total[1m]))"
              },
              "responseFormat": "json"
            }
          },
          {
            "name": "Check Pod Count",
            "type": "n8n-nodes-base.httpRequest",
            "config": {
              "method": "GET",
              "url": "http://localhost:8000/api/monitoring/pod-status",
              "responseFormat": "json"
            }
          },
          {
            "name": "Scale Decision",
            "type": "n8n-nodes-base.if",
            "config": {
              "condition": "{{ $node['Check Current Load'].json.data.result[0].value[1] > 50 && $node['Check Pod Count'].json.current_pods < 10 }}",
              "description": "Scale up if load > 50 and pods < 10"
            }
          },
          {
            "name": "Trigger Kubernetes Scale Up",
            "type": "n8n-nodes-base.httpRequest",
            "config": {
              "method": "PATCH",
              "url": "{{ env.KUBERNETES_API }}/apis/apps/v1/namespaces/default/deployments/clisonix-alba/scale",
              "headers": {
                "Authorization": "Bearer {{ env.KUBERNETES_TOKEN }}"
              },
              "body": {
                "spec": {
                  "replicas": "{{ Math.min($node['Check Pod Count'].json.current_pods + 2, 15) }}"
                }
              }
            }
          },
          {
            "name": "Log Scale Event",
            "type": "n8n-nodes-base.postgres",
            "config": {
              "operation": "insert",
              "table": "scaling_events",
              "values": {
                "timestamp": "{{ new Date().toISOString() }}",
                "action": "scale_up",
                "previous_pods": "{{ $node['Check Pod Count'].json.current_pods }}",
                "new_pods": "{{ Math.min($node['Check Pod Count'].json.current_pods + 2, 15) }}",
                "load": "{{ $node['Check Current Load'].json.data.result[0].value[1] }}"
              }
            }
          }
        ]
      },
      {
        "id": "workflow_slack_integration",
        "name": "Slack Integration & Notifications",
        "description": "Send Clisonix updates and alerts to Slack",
        "trigger": "Webhook from Clisonix API",
        "nodes": [
          {
            "name": "Webhook Trigger",
            "type": "n8n-nodes-base.webhook",
            "config": {
              "path": "clisonix-webhook",
              "description": "Receives events from Clisonix API"
            }
          },
          {
            "name": "Determine Event Type",
            "type": "n8n-nodes-base.switch",
            "config": {
              "cases": [
                {
                  "condition": "{{ $node.Webhook.json.event_type == 'anomaly' }}",
                  "channel": "#alerts"
                },
                {
                  "condition": "{{ $node.Webhook.json.event_type == 'milestone' }}",
                  "channel": "#achievements"
                },
                {
                  "condition": "{{ $node.Webhook.json.event_type == 'analysis' }}",
                  "channel": "#analytics"
                }
              ]
            }
          },
          {
            "name": "Format Slack Message",
            "type": "n8n-nodes-base.set",
            "config": {
              "blocks": "{{ `[{\"type\": \"header\", \"text\": {\"type\": \"plain_text\", \"text\": \"${$node.Webhook.json.title}\"}}, {\"type\": \"section\", \"text\": {\"type\": \"mrkdwn\", \"text\": \"${$node.Webhook.json.message}\"}}]` }}"
            }
          },
          {
            "name": "Send to Slack",
            "type": "n8n-nodes-base.slack",
            "config": {
              "channel": "{{ $node['Determine Event Type'].json.channel }}",
              "text": "{{ $node['Format Slack Message'].json.blocks }}"
            }
          }
        ]
      }
    ],
    "import_instructions": {
      "step_1": "Copy entire JSON block above",
      "step_2": "Open n8n â†’ Settings â†’ Import",
      "step_3": "Paste JSON and click Import",
      "step_4": "Update API endpoints if needed (localhost:8000 â†’ your_api_url)",
      "step_5": "Set environment variables (API keys, webhook URLs)",
      "step_6": "Activate workflows",
      "step_7": "Monitor in Execution History"
    },
    "environment_variables_required": {
      "OPENAI_API_KEY": "Your OpenAI API key for CrewAI/LangChain",
      "ANTHROPIC_API_KEY": "Your Anthropic API key for Claude",
      "SLACK_TOKEN": "Slack bot token for notifications",
      "PAGERDUTY_KEY": "PagerDuty routing key for critical alerts",
      "KUBERNETES_API": "Kubernetes API endpoint for auto-scaling",
      "KUBERNETES_TOKEN": "Kubernetes authentication token",
      "REPORT_EMAIL": "Email address for daily reports",
      "CLISONIX_API_URL": "Base URL of Clisonix API (default: http://localhost:8000)"
    },
    "usage_examples": {
      "eeg_monitoring": "Monitors EEG anomalies every 5 min, interprets with Claude, alerts via Slack",
      "prometheus_monitoring": "Checks Prometheus metrics every 10 min, triggers PagerDuty if threshold exceeded",
      "daily_reports": "Generates comprehensive reports using CrewAI Trinity at 8 AM daily",
      "auto_scaling": "Monitors load every 30s, scales Kubernetes deployment when needed",
      "slack_integration": "Receives webhook events from Clisonix, formats and sends to appropriate Slack channel"
    },
    "next_steps": [
      "Install n8n: docker run -it --rm -p 5678:5678 -v ~/.n8n:/home/node/.n8n n8nio/n8n:latest",
      "Create n8n account and authenticate",
      "Import workflows from this file",
      "Configure API endpoints and credentials",
      "Test each workflow with sample data",
      "Enable notifications and monitoring",
      "Set up Slack/email for alerts"
    ]
  }
}
